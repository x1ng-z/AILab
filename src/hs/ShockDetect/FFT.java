package hs.ShockDetect;

import org.apache.log4j.Logger;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

/**
 * @author zzx
 * @version 1.0
 * @date 2020/7/18 13:13
 */
public class FFT {
    private static boolean DEBUG=false;
    private static final Logger logger = Logger.getLogger(FFT.class);
    private final static double pi = 3.1415926;
    private List<Double> realdata;
    private List<Double> X;

    public FFT(List<Double> realdata) {
        this.realdata = realdata;
    }

    public void computeByOriginal() {
        if (realdata.size() == 0) {
            logger.warn("求FFT时数据为空，不允许进行计算");
            return;
        }
        int N = realdata.size();
        X = new ArrayList<>();
        int indereal = 0;

        for (int indexff = 0; indexff < N; indexff++) {
            List<Complex> Xi=new ArrayList<>();
            for (Double partofdata : realdata) {
                Xi.add(Complex.Euler(partofdata, -1*indexff * indereal * (2 * pi / N)));
                indereal++;
            }
            Complex sum=Xi.get(0);
            for(int indexx=1;indexx<Xi.size();indexx++){
                sum=sum.add(Xi.get(indexx));
            }
            X.add(sum.modl());
        }


    }

    /***
     *数据需要减去均值，取1/3的幅值来算低频信号,并求出其有效数据
     * */
    public double computeLowFrequenByMean() {
        if (realdata.size() == 0) {
            logger.warn("求FFT时数据为空，不允许进行计算");
            return 0d;
        }
        double sumrealdata=0d;
        for(double data:realdata){
            sumrealdata+=data;
        }

        int N = realdata.size();
        double meanrealdata=sumrealdata/N;
        X = new ArrayList<>();
        int indereal = 0;

        for (int indexff = 0; indexff < N; indexff++) {
            List<Complex> Xi=new ArrayList<>();
            for (Double partofdata : realdata) {
                Xi.add(Complex.Euler(partofdata-meanrealdata, -1*indexff * indereal * (2 * pi / N)));
                indereal++;
            }
            Complex sum=Xi.get(0);
            for(int indexx=1;indexx<Xi.size();indexx++){
                sum=sum.add(Xi.get(indexx));
            }
            X.add(sum.modl());
        }

        //取左一半的数据的1/3数据进行低频有效幅值计算
        int picknum=(X.size()/2)/3;
        double EA=(X.get(0)/N)*(X.get(0)/N);

        for(int index=1;index<picknum;index++){
            EA+= (X.get(index)*2/N)*(X.get(index)*2/N);
        }

        //just for debug
        if(DEBUG){
            X.set(0,X.get(0)/N);
            for(int index=1;index<picknum;index++){
                X.set(index,X.get(index)*2/N);
            }
        }

        return Math.sqrt(EA/picknum);
    }

    public List<Double> getX() {
        return X;
    }
    public static void main(String[] args) {
        FFT fft=new FFT(Arrays.asList(888.625,
                888.625,
                888.625,
                888.625,
                888.5,
                888.5,
                888.5,
                888.375,
                888.375,
                888.375,
                888.25,
                888.25,
                888.125,
                888.125,
                888.125,
                888.0,
                887.875,
                887.875,
                887.875,
                887.75,
                887.75,
                887.625,
                887.625,
                887.5,
                887.5,
                887.375,
                887.375,
                887.25,
                887.25,
                887.125,
                887.125,
                887.0,
                887.0,
                886.875,
                886.875,
                886.75,
                886.75,
                886.625,
                886.5,
                886.5,
                886.375,
                886.375,
                886.25,
                886.25,
                886.125,
                886.125,
                886.125,
                886.0,
                886.0,
                886.0,
                885.875,
                885.875,
                885.875,
                885.75,
                885.75,
                885.75,
                885.75,
                885.75,
                885.625,
                885.625,
                885.625,
                885.625,
                885.625,
                885.625,
                885.625,
                885.625,
                885.625,
                885.625,
                885.625,
                885.625,
                885.625,
                885.625,
                885.75,
                885.75,
                885.75,
                885.75,
                885.75,
                885.75,
                885.75,
                885.75,
                885.875,
                885.875,
                885.875,
                885.875,
                885.875,
                886.0,
                886.0,
                886.0,
                886.0,
                886.125,
                886.125,
                886.125,
                886.125,
                886.25,
                886.25,
                886.25,
                886.25,
                886.25,
                886.125,
                886.125,
                886.125,
                886.125,
                886.125,
                886.0,
                886.0,
                885.875,
                885.875,
                885.75,
                885.75,
                885.625,
                885.5,
                885.5,
                885.375,
                885.25,
                885.25,
                885.125,
                885.125,
                885.0,
                884.875,
                884.875,
                884.75,
                884.75,
                884.625,
                884.625,
                884.5,
                884.5,
                884.5,
                884.5,
                884.375,
                884.375,
                884.375,
                884.375,
                884.375,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.0,
                884.0,
                884.0,
                884.0,
                883.875,
                883.875,
                883.875,
                883.75,
                883.625,
                883.625,
                883.625,
                883.5,
                883.375,
                883.375,
                883.375,
                883.25,
                883.125,
                883.125,
                883.0,
                883.0,
                882.875,
                882.875,
                882.75,
                882.75,
                882.75,
                882.625,
                882.625,
                882.5,
                882.5,
                882.5,
                882.5,
                882.375,
                882.375,
                882.375,
                882.375,
                882.375,
                882.375,
                882.375,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.125,
                882.125,
                882.125,
                882.125,
                882.125,
                882.125,
                882.125,
                882.125,
                882.125,
                882.125,
                882.125,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.25,
                882.375,
                882.375,
                882.375,
                882.375,
                882.5,
                882.5,
                882.5,
                882.5,
                882.625,
                882.625,
                882.75,
                882.75,
                882.75,
                882.875,
                882.875,
                883.0,
                883.0,
                883.125,
                883.125,
                883.25,
                883.25,
                883.375,
                883.375,
                883.5,
                883.625,
                883.625,
                883.75,
                883.875,
                883.875,
                884.0,
                884.0,
                884.125,
                884.125,
                884.25,
                884.375,
                884.375,
                884.5,
                884.5,
                884.625,
                884.625,
                884.75,
                884.75,
                884.75,
                884.875,
                884.875,
                885.0,
                885.0,
                885.0,
                885.125,
                885.125,
                885.125,
                885.125,
                885.25,
                885.25,
                885.25,
                885.25,
                885.25,
                885.25,
                885.25,
                885.375,
                885.375,
                885.375,
                885.375,
                885.375,
                885.375,
                885.5,
                885.5,
                885.5,
                885.5,
                885.625,
                885.625,
                885.625,
                885.75,
                885.75,
                885.75,
                885.75,
                885.875,
                885.875,
                886.0,
                886.0,
                886.0,
                886.125,
                886.125,
                886.125,
                886.25,
                886.25,
                886.25,
                886.375,
                886.375,
                886.375,
                886.375,
                886.375,
                886.5,
                886.5,
                886.5,
                886.5,
                886.5,
                886.5,
                886.5,
                886.5,
                886.5,
                886.5,
                886.5,
                886.375,
                886.375,
                886.375,
                886.25,
                886.25,
                886.25,
                886.125,
                886.125,
                886.0,
                886.0,
                885.875,
                885.875,
                885.75,
                885.625,
                885.625,
                885.625,
                885.5,
                885.375,
                885.375,
                885.25,
                885.25,
                885.125,
                885.125,
                885.125,
                885.0,
                885.0,
                884.875,
                884.875,
                884.875,
                884.75,
                884.75,
                884.75,
                884.625,
                884.625,
                884.625,
                884.625,
                884.625,
                884.5,
                884.5,
                884.5,
                884.5,
                884.5,
                884.5,
                884.5,
                884.5,
                884.5,
                884.5,
                884.5,
                884.5,
                884.5,
                884.5,
                884.5,
                884.5,
                884.375,
                884.375,
                884.375,
                884.375,
                884.375,
                884.375,
                884.375,
                884.375,
                884.375,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.25,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.125,
                884.25,
                884.25,
                884.25,
                884.25,
                884.375,
                884.375,
                884.5,
                884.5,
                884.625,
                884.625,
                884.75,
                884.75,
                884.875,
                884.875,
                885.0,
                885.125,
                885.125,
                885.125,
                885.25,
                885.375,
                885.5,
                885.5,
                885.625,
                885.625,
                885.75,
                885.875,
                886.0,
                886.0,
                886.125,
                886.125,
                886.25,
                886.375,
                886.375,
                886.5,
                886.5,
                886.625,
                886.625,
                886.75,
                886.75,
                886.75,
                886.875,
                886.875,
                887.0,
                887.0,
                887.0,
                887.125,
                887.125,
                887.25,
                887.25,
                887.25,
                887.375,
                887.375,
                887.375,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.5,
                887.625,
                887.625,
                887.625,
                887.75,
                887.75,
                887.75,
                887.875,
                888.0,
                888.0,
                888.125,
                888.25,
                888.375,
                888.5,
                888.5,
                888.75,
                888.875,
                889.0,
                889.125,
                889.375,
                889.5,
                889.625,
                889.75,
                890.0,
                890.125,
                890.25,
                890.375,
                890.625,
                890.75,
                890.875,
                891.0,
                891.25,
                891.375,
                891.5,
                891.5,
                891.625,
                891.75,
                891.875,
                892.0,
                892.125,
                892.125,
                892.125,
                892.25,
                892.375,
                892.375,
                892.375,
                892.5,
                892.5,
                892.5,
                892.5,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.75,
                892.75,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.625,
                892.5,
                892.5,
                892.5,
                892.5,
                892.5,
                892.5,
                892.5,
                892.5,
                892.5,
                892.375,
                892.375,
                892.375,
                892.375,
                892.375,
                892.375,
                892.375,
                892.375,
                892.375,
                892.375,
                892.375,
                892.375,
                892.375,
                892.375,
                892.375,
                892.375,
                892.25));
        long start=System.currentTimeMillis();
        double result=fft.computeLowFrequenByMean();

        System.out.println("result="+result+", cost="+(System.currentTimeMillis()-start)+"ms");


    }



}
